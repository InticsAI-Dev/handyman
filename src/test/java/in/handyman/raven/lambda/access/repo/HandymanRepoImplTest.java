package in.handyman.raven.lambda.access.repo;

import in.handyman.raven.lambda.doa.audit.ActionExecutionAudit;
import in.handyman.raven.lambda.doa.audit.PipelineExecutionAudit;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;

@Slf4j
class HandymanRepoImplTest {

    private final HandymanRepoImpl repoR2 = new HandymanRepoImpl();

    @Test
    void findConfigEntities() {
        repoR2.findAllCommonConfigs();
        repoR2.findAllInstances();
        repoR2.findAllProcesses();
        repoR2.findAllResourceConfigs();
        log.info("Hello ");
    }

    @Test
    void insertPipeline() {
        log.debug("Hello ");
        repoR2.insertPipeline(PipelineExecutionAudit.builder().build());
    }

    @Test
    void insertAction() {
        final ActionExecutionAudit build = ActionExecutionAudit.builder().build();
        repoR2.insertAction(build);
        build.setLog("Hello");
        repoR2.update(build);
        log.error("Hello ");
        System.out.println("UPDATE ENDED..");
    }

    @Test
    public void testFindAll() {
        final ActionExecutionAudit build = ActionExecutionAudit.builder().build();
        System.out.println("STARTED");
        build.setLog("hello1 before update");
        build.setPipelineId(1235L);
        build.setThreadName("ForkJoinPool-2-worker-1");
        build.setParentPipelineName("batch.processor");
        build.setPipelineName("template.questions.onboarding");
        build.setActionName("get_count");
        build.setExecutionGroupId(1);
        build.setRootPipelineId(1L);
        build.setLambdaName("root.processor");
        build.setInputNode("{\"name\":\"get_count\",\"source\":\"intics_zio_db_conn\",\"value\":\"select count(st.synonym) as synonym_count\\n              from sor_meta.sor_tsynonym st\\n              where st.synonym ='Template Name' and st.tenant_id=5;\\n\\n              select max(synonym_id)+1 as max_synonym_id\\n              from sor_meta.sor_tsynonym st ;\",\"condition\":true}");
        build.setParentActionName("Insert into synonym and question tables");
        build.setContextNode("{\"consumer.API.count\":\"5\",\"template.detection.consumer.API.count\":\"1\",\"macro.copro.start.action\":\"10000\",\"document.uri\":\"https://agadia.intics.ai/api/v1/downloadOutboundZip/\",\"created_user_id\":\"5\",\"checkboxImageWidth\":\"700\",\"xenon\":\"XENON_MODEL\",\"gen_id.root_pipeline_id\":\"1\",\"origin.workspace.process.triton\":\"root.processor#8\",\"process-id\":\"1\",\"minBucketProcessor\":\"root.processor#1\",\"batch.processing.split.count\":\"7\",\"scalar.adapter.activator\":\"false\",\"macro.copro.stop.action\":\"10000\",\"grey.scale.conversion.multipart.upload.url\":\"http://grey.scale.conversion.multipart.instance1:10001/multipart-upload\",\"alchemy.outbound.kvp.url\":\"http://intics.alchemy:8189/alchemy/api/v1/response/kie\",\"read.batch.size\":\"5\",\"cron.expression\":\"0 */5 * ? * *\",\"masterdata_threshold\":\"0.85\",\"table.extraction.header.exclude\":\"false\",\"BORON_MODEL_NAME\":\"BORON\",\"figure.detection.multipart.upload.url\":\"http://figure.detection.multipart.instance1:10001/multipart-upload\",\"copro.resume-parser.url\":\"http://192.168.10.241:8888/copro/resume-parser\",\"root.processor.ddl.activator\":\"true\",\"textExtractionStartCommand\":\"gunicorn app.text_extractor_api:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:10182 --timeout 600 --thread 4  --reload\",\"ingestion.iterator.threadcount\":\"60\",\"template.detection.activator\":\"false\",\"pipeline_bus_mode.noise_model\":\"false\",\"alchemy.refresh.url\":\"http://intics.alchemy:8189/alchemy/api/v1/auth/refresh\",\"okhttp.client.timeout\":\"360\",\"template.detection.start.action\":\"false\",\"alchemy.login.url\":\"http://intics.alchemy:8189/alchemy/api/v1/auth/login\",\"binaryImageHeight\":\"500\",\"grouping.duplicates.pre.vqa.flag\":\"false\",\"drop.temporary.table.voting.enable\":\"true\",\"pipeline_bus_mode.vqa_printed\":\"false\",\"table.response.download.url\":\"http://table.extraction.v1.multipart.instance1:10001/multipart-download\",\"copro.auto.rotation.export\":\"COPRO_AUTO_ROTATOR_ENABLE\",\"batchMode\":\"false\",\"pipeline-id\":\"1\",\"paper.classification.activator\":\"false\",\"grey.scale.conversion.response.download.url\":\"http://grey.scale.conversion.multipart.instance1:10001/multipart-download\",\"origin.workspace.process.legacy\":\"root.processor#7\",\"pipeline_bus_mode.phrase_match\":\"false\",\"text.extraction.stop.action\":\"false\",\"voting.v1.activator\":\"false\",\"xenon.multipart.upload.url\":\"http://xenon.multipart.instance1:10001/multipart-upload\",\"preprocess.main.caller.activator\":\"true\",\"init_process_id.process_id\":\"1\",\"secondBucketBatchLimit\":\"50\",\"argon.multipart.upload.url\":\"http://argon.multipart.instance1:10001/multipart-upload\",\"XENON_MODEL_NAME\":\"XENON\",\"stage\":\"INGESTION\",\"ingestion.file.threshold\":\"0\",\"paper.filter.zero.shot.classifier.threadcount\":\"1\",\"legacy.transform.activator\":\"false\",\"invoice.validator.activator\":\"false\",\"table.extraction.consumer.API.count\":\"1\",\"minThirdBucketThreshold\":\"10\",\"last_updated_user_id\":\"5\",\"template.detection.stop.action\":\"false\",\"copro.template.detection.url\":\"http://triton.copro.template.detection.instance1:8900/v2/models/argon-vqa-service/versions/1/infer\",\"document_id\":\"TMP-AGD-001\",\"copro.grey.scale.conversion.url\":\"http://copro.grey.scale.conversion.instance1:10197/copro/preprocess/grey-scale-conversion\",\"root.filter.activator\":\"false\",\"paper.itemizer.multipart.upload.url\":\"http://paper.itemizer.multipart.instance1:10001/multipart-upload\",\"copro.paper.itemization.export\":\"COPRO_PAPER_ITERATOR_ENABLE\",\"maxBucketProcessor\":\"root.processor#1\",\"triton.request.activator\":\"true\",\"text.extraction.multipart.upload.url\":\"http://text.extraction.multipart.instance1:10001/multipart-upload\",\"resume.parser.multipart.upload.url\":\"http://copro.infer.resume:10001/multipart-upload\",\"time_stamp_ingestion.consumed_on_ts\":\"2024-04-22 20:19:30.405936\",\"pipeline.bus.mode\":\"false\",\"multitude.pre.vqa.thread.count\":\"5\",\"auto.rotation.multipart.upload.url\":\"http://auto.rotation.multipart.instance1:10001/multipart-upload\",\"copro.auto.rotation.admin.start.url\":\"http://copro.auto.rotation:10281/copro/admin/process-start\",\"copro.paper.itemization.admin.stop.url\":\"http://copro.paper.itemizer:10280/copro/admin/process-stop\",\"copro.table-extraction.url.v4\":\"http://copro.table.extraction.v4.instance1:18890/copro/table-attribution-with-header-v4\",\"document_info.document_id\":\"1\",\"copro.table-extraction.url.v2\":\"http://copro.table.extraction.v2.instance1:18889/copro/table-attribution-with-header\",\"copro.table-extraction.url.v3\":\"http://copro.table.extraction.v3.instance1:18887/copro/table-attribution-yolo\",\"copro.table-extraction.url.v1\":\"http://copro.table.extraction.v1.instance1:18888/copro/table-attribution\",\"pipeline_bus_mode.template_detection\":\"false\",\"currency.detection.multipart.upload.url\":\"http://currency.detection.multipart.instance1:10001/multipart-upload\",\"producer_process_id\":\"1\",\"alchemy.base.url\":\"https://demo.intics.ai/alchemy\",\"imageDpi\":\"72\",\"delete.duplicates.pre.vqa.flag\":\"false\",\"copro.template.detection.export\":\"COPRO_DOCNET_ENABLE\",\"response.builder.activator\":\"false\",\"target_directory_path\":\"/data/output\",\"copro.stop.thread.sleep\":\"0\",\"dir_path\":\"/data/multipart-files/data/5/channel/882/139330901621830074\",\"product.response.builder.activator\":\"false\",\"inbound_id\":\"2242\",\"ut.model.activator\":\"false\",\"outbound.file.uri.format.specifer\":\"file\",\"drop.temporary.table.filter.enable\":\"true\",\"drop.temporary.table.qr.enable\":\"true\",\"merger.start.action\":\"false\",\"paper.classification.default.value\":\"Printed\",\"table.extraction.activator\":\"false\",\"multitude.pre.vqa.option\":\"PARALLEL\",\"pipeline_bus_mode.text_extraction\":\"false\",\"gatekeeper.init.process\":\"root.processor#10\",\"gatekeeper.url\":\"http://intics.gatekeeper:40002/\",\"drop.temporary.table.preprocess.enable\":\"true\",\"docnutImageDpi\":\"72\",\"eoc.splitting.main.activator\":\"false\",\"pipeline_bus_mode.auto_rotation\":\"false\",\"text.extraction.consumer.API.count\":\"1\",\"copro.trinity-attribution.printed.url\":\"http://triton.copro.valuation.printed.instance1:8900/v2/models/argon-vqa-service/versions/1/infer\",\"eoc.detail.thread.count\":\"2\",\"group_id\":\"2242\",\"vulcan.url\":\"http://intics.app:11189/vulcan/api/v1/pipeline\",\"alchemy.origin.upload.url\":\"http://intics.alchemy:8189/alchemy/api/v1/info/origin/upload\",\"auto.rotation.response.download.url\":\"http://auto.rotation.multipart.instance1:10001/multipart-download\",\"drop.temporary.table.sorGrouping.enable\":\"true\",\"autoq.multipart.upload.url\":\"http://autoq.detection.multipart.instance1:10001/multipart-upload\",\"write.batch.size\":\"5\",\"eoc.transform.activator\":\"false\",\"basepath\":\"/lambda/lambda-pr1/\",\"voting_weight_threshold\":\"300\",\"auto.rotation.consumer.API.count\":\"1\",\"KRYPTON_MODEL_NAME\":\"KRYPTON\",\"copro.text.extraction.admin.stop.url\":\"http://copro.data.extraction:10282/copro/admin/process-stop\",\"impira.transform.activator\":\"false\",\"pipeline_bus_mode.merger_start\":\"false\",\"face.detection.multipart.upload.url\":\"http://face.detection.multipart.instance1:10001/multipart-upload\",\"alchemy.outbound.table.url\":\"http://intics.alchemy:8189/alchemy/api/v1/response/table\",\"coveragereport.processor.activator\":\"false\",\"validation.purger.scalar.activator\":\"true\",\"copro.start.thread.sleep\":\"0\",\"autoRotationStartCommand\":\"gunicorn app.auto_rotator_api:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:10181 --timeout 600 --thread 4  --reload\",\"pipeline_bus_mode.ut_model\":\"false\",\"checkboxImageHeight\":\"700\",\"synonyms\":\"string\",\"modBucketProcessor\":\"root.processor#1\",\"table.extraction.v2.multipart.upload.url\":\"http://table.extraction.v2.multipart.instance1:10001/multipart-upload\",\"auto.rotation.start.action\":\"false\",\"qr.extraction.processor.activator\":\"false\",\"NEON_MODEL_NAME\":\"NEON\",\"argon\":\"ARGON_MODEL\",\"zip.file.batch.generation\":\"false\",\"drop.temporary.table.ingestion.enable\":\"true\",\"gatekeeper.apisecret\":\"password@123\",\"channel_id\":\"882\",\"pipeline_bus_mode.zero_shot\":\"false\",\"status\":\"STAGED\",\"tenant_id\":\"5\",\"masterdata.processor.activator\":\"false\",\"table.extraction.v1.multipart.upload.url\":\"http://table.extraction.v1.multipart.instance1:10001/multipart-upload\",\"batch_id\":\"BATCH-2242_0\",\"multipart.file.upload.activator\":\"true\",\"maxThirdBucketThreshold\":\"20\",\"pipeline_bus_mode.vqa_handwritten\":\"false\",\"template.fuzzy.threshold\":\"30\",\"paperItemizationStartCommand\":\"gunicorn app.paper_iterator_api:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:10180 --timeout 600 --thread 4  --reload\",\"outbound.delivery.notify\":\"false\",\"sys_thread_count\":\"2\",\"binaryImageWidth\":\"500\",\"checkbox.detection.multipart.upload.url\":\"http://checkbox.detection.multipart.instance1:10001/multipart-upload\",\"text.extraction.start.action\":\"false\",\"copro.text.extraction.admin.start.url\":\"http://copro.data.extraction:10282/copro/admin/process-start\",\"paper.filter.phrase.match.threadcount\":\"1\",\"pipeline_bus_mode.paper_itemizer\":\"false\",\"document_type\":\"DRIVING_LICENSE\",\"copro.autorotation.url\":\"http://triton.copro.auto.rotation.instance1:8200/v2/models/auto-rotator-service/versions/1/infer\",\"printed.stop.action\":\"false\",\"alchemy.origin.valuation.url\":\"http://intics.alchemy:8189/alchemy/api/v1/valuation/origin\",\"firstBucketBatchLimit\":\"150\",\"copro.paper-itemizer.url\":\"http://triton.copro.paper.itemizer.instance1:8100/v2/models/paper-iterator-service/versions/1/infer\",\"gen_group_id.inbound_id\":\"2242\",\"impira.question.weight.threshold\":\"150\",\"paper.itemizer.response.download.url\":\"http://paper.itemizer.multipart.instance1:10001/multipart-download\",\"copro.auto.rotation.admin.stop.url\":\"http://copro.auto.rotation:10281/copro/admin/process-stop\",\"drugname.api.url\":\"https://fbmltprd.rxcontinuum.com/docextraction/api/Inbounddocument_in/searchdrugs\",\"triton.request.table.headers.activator\":\"false\",\"zero.shot.stop.action\":\"false\",\"doc.delivery.notify.url\":\"https://fbmltprd.rxcontinuum.com/docextraction/api/Inbounddocument_in/docextractdeliverynotify\",\"vulcan.base.url\":\"http://intics.app:11189/vulcan\",\"voting_rank_threshold\":\"4\",\"urgency.triage.activator\":\"false\",\"ingestion.main.caller.activator\":\"true\",\"copro.data-extraction.url\":\"http://triton.copro.data.extraction.instance1:8300/v2/models/text-extractor-service/versions/1/infer\",\"auto.rotation.stop.action\":\"false\",\"ARGON_MODEL_NAME\":\"ARGON\",\"?column?\":\"1\",\"filepath\":\"/root.processor.lmd\",\"migrationProcessVariable\":\"question.verse.main\",\"thirdBucketBatchLimit\":\"100\",\"parent-pipeline-id\":\"null\",\"multitude.pre.vqa.activator\":\"true\",\"paper.itemization.stop.action\":\"false\",\"gen_group_id.group_id\":\"2242\",\"alchemy.product.response.url\":\"http://intics.alchemy:8189/alchemy/api/v1/response\",\"minFirstBucketThreshold\":\"1\",\"pipeline_bus_mode.merger_stop\":\"false\",\"pipeline.train.mode\":\"false\",\"pipeline_bus_mode.validation\":\"false\",\"origin_type\":\"WORKSPACE\",\"validation.restricted-answers\":\"No,None of the above,None,:,/No,(n\",\"drop.macro.schema.enable\":\"false\",\"drop.temporary.table.sorTransaction.enable\":\"true\",\"copro.trinity-attribution.handwritten.url\":\"http://triton.copro.valuation.handwritten.instance1:9000/v2/models/xenon-vqa-service/versions/1/infer\",\"sor.grouping.iterator.threadcount\":\"20\",\"master.data.outboundZip\":\"false\",\"ingestion.processor.threadcount\":\"2\",\"zero.shot.start.action\":\"false\",\"root-ref-id\":\"1\",\"multiverse.activator\":\"false\",\"streamingMode\":\"true\",\"pipeline_bus_mode.paper_classificationr\":\"false\",\"multiImageHeight\":\"500\",\"channel.name.placeholder.value\":\"Dmx\",\"drop.temporary.table.urgencyTriage.enable\":\"true\",\"alchemy.migration.activator\":\"false\",\"document.type.change.check\":\"false\",\"sor.transaction.activator\":\"false\",\"copro.text.extraction.export\":\"COPRO_MYNDEE_ENABLE\",\"product.pipeline.flag\":\"false\",\"paper.itemization.start.action\":\"false\",\"pipeline_bus_mode.qr_extraction\":\"false\",\"maxSecondBucketThreshold\":\"10\",\"resourceUri\":\"https://devimgext.pahub.com/\",\"paper.itemizer.consumer.API.count\":\"1\",\"minSecondBucketThreshold\":\"4\",\"table.extraction.v3.multipart.upload.url\":\"http://table.extraction.v3.multipart.instance1:10001/multipart-upload\",\"grey.scale.conversion.activator\":\"false\",\"greyscale.conversion.consumer.API.count\":\"1\",\"alchemy.table.extraction\":\"alchemy.table.extraction\",\"triton.grey.scale.conversion.request.activator\":\"false\",\"maxFirstBucketThreshold\":\"3\",\"validation.multiverse-mode\":\"true\",\"multiImageWidth\":\"500\",\"channel.name.default.value\":\"MULTIVERSE\",\"copro.paper.itemization.admin.start.url\":\"http://copro.paper.itemizer:10280/copro/admin/process-start\"}");
        build.setExecutionStatusId(5);
        build.setProcessName("root.processor");
        build.setParentActionId(71L);
        build.setParentPipelineId(10L);
        repoR2.insertAction(build);
        System.out.println("ENDED..");
    }
}
